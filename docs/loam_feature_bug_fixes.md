# LOAM Feature μ¶”μ¶ λ²„κ·Έ μμ • λ³΄κ³ μ„ (μµμΆ…λ³Έ)

**μ‘μ„±μΌ**: 2026λ…„ 2μ›” 10μΌ  
**μµμΆ… μμ •**: 2026λ…„ 2μ›” 10μΌ 13:51 KST  
**λ€μƒ νμΌ**: `src/loam_feature.cpp`  
**Docker μ»¨ν…μ΄λ„**: bottom-lidar (ID: 5391fcf42791)

---

## β οΈ μ¤‘μ” μ‚¬ν•­

**μ΄ λ³΄κ³ μ„λ” ν„μ¬ μ½”λ“λ² μ΄μ¤μ— μ‹¤μ λ΅ μ μ©λ λ²„κ·Έ μμ • μ‚¬ν•­μ„ λ°μν•©λ‹λ‹¤.**

μ‘μ—… μ¤‘ μ›λ³Έ νμΌμ΄ LIO-SAM μ¤νƒ€μΌ κµ¬ν„μΌλ΅ κµμ²΄λμ–΄, `extract_loam_features_normal_based()` ν•¨μκ°€ μ‚­μ λμ—μµλ‹λ‹¤. λ”°λΌμ„ ν•΄λ‹Ή ν•¨μμ™€ κ΄€λ ¨λ λ²„κ·Έ(Bug #2, Bug #4)λ” μμ • λ€μƒμ—μ„ μ μ™Έλμ—μµλ‹λ‹¤.

---

## π“‹ λ©μ°¨

1. [κ°μ”](#κ°μ”)
2. [μ½”λ“λ² μ΄μ¤ λ³€κ²½ μ‚¬ν•­](#μ½”λ“λ² μ΄μ¤-λ³€κ²½-μ‚¬ν•­)
3. [μμ •λ λ²„κ·Έ](#μμ •λ-λ²„κ·Έ)
4. [λΉλ“ κ²€μ¦](#λΉλ“-κ²€μ¦)
5. [κ²°λ΅ ](#κ²°λ΅ )

---

## κ°μ”

LOAM (Lidar Odometry and Mapping) μ•κ³ λ¦¬μ¦μ νΉμ§•μ  μ¶”μ¶ μ½”λ“λ¥Ό λ¶„μ„ν•κ³  λ²„κ·Έλ¥Ό μμ •ν•μ€μµλ‹λ‹¤.

### μµμΆ… μμ • μ”μ•½

| λ²„κ·Έ ID | μ„μΉ | μ‹¬κ°λ„ | μƒνƒ | λΉ„κ³  |
|---------|------|--------|------|------|
| Bug #1 | `extract_loam_features_knn()` Line 297 | π”΄ HIGH | β… **μμ • μ™„λ£** | Division by zero λ°©μ§€ |
| Bug #2 | `extract_loam_features_normal_based()` | π”΄ HIGH | β **ν•΄λ‹Ή μ—†μ** | ν•¨μ μ‚­μ λ¨ |
| Bug #3 | `extract_loam_features_knn()` Line 279 | π΅ MEDIUM | β… **μμ • μ™„λ£** | KNN κ²€μƒ‰ κ²°κ³Ό κ²€μ¦ |
| Bug #4 | `extract_loam_features_normal_based()` | π΅ MEDIUM | β **ν•΄λ‹Ή μ—†μ** | ν•¨μ μ‚­μ λ¨ |
| Improvement #5 | `extract_loam_features_ring_based()` | πΆ LOW | β **ν•΄λ‹Ή μ—†μ** | μƒ κµ¬ν„μΌλ΅ κµμ²΄λ¨ |

---

## μ½”λ“λ² μ΄μ¤ λ³€κ²½ μ‚¬ν•­

μ‘μ—… μ¤‘ μ›λ³Έ νμΌμ΄ λ‹¤λ¥Έ κµ¬ν„μΌλ΅ κµμ²΄λμ—μµλ‹λ‹¤:

| ν•­λ© | μ›λ³Έ νμΌ | ν„μ¬ νμΌ |
|------|-----------|-----------|
| **μ΄ λΌμΈ μ** | 390μ¤„ | 345μ¤„ β†’ 351μ¤„ (μμ • ν›„) |
| **κµ¬ν„ λ°©μ‹** | μ›λ³Έ LOAM | LIO-SAM μ¤νƒ€μΌ |
| **ν•¨μ κ°μ** | 3κ° | 2κ° |
| **`extract_loam_features_ring_based`** | β… κ°„λ‹¨ν• κµ¬ν„ | β… λ³µμ΅ν• LIO-SAM κµ¬ν„ |
| **`extract_loam_features_knn`** | β… μ΅΄μ¬ | β… μ΅΄μ¬ (λ²„κ·Έ μμ •λ¨) |
| **`extract_loam_features_normal_based`** | β… μ΅΄μ¬ | β **μ‚­μ λ¨** |

**κ²°κ³Όμ μΌλ΅ μμ • κ°€λ¥ν• λ²„κ·Έλ” Bug #1κ³Ό Bug #3λ§ λ‚¨μ•μµλ‹λ‹¤.**

---

## μμ •λ λ²„κ·Έ

### π”΄ Bug #1: Division by Zero (0μΌλ΅ λ‚λ„κΈ°) μ„ν—

#### μ„μΉ
- **νμΌ**: `src/loam_feature.cpp`
- **ν•¨μ**: `extract_loam_features_knn()`
- **λΌμΈ**: 297-300 (μμ • μ „)

#### λ¬Έμ  μ½”λ“ (μμ • μ „)

```cpp
// Line 295-298 (μμ • μ „)
// Curvature κ³„μ‚°: c = ||sum(Xi - Xj)|| / (|S| * ||Xi||)
// LOAM λ…Όλ¬Έ: c = ||Ξ£(Xi - Xj)|| / (|S| * ||Xi||)
double c = (valid_neighbors > 0) ? diff_sum.norm() / (valid_neighbors * X_i.norm()) : 0.0;
curvatures[i] = c;
```

#### λ¬Έμ μ 

1. **μμΉμ  λ¶μ•μ •μ„±**: `X_i.norm()`μ΄ λ§¤μ° μ‘μ€ κ°’ (μ: 0.001)μΈ κ²½μ°, λ‚λ„κΈ° μ—°μ‚°μΌλ΅ μΈν•΄ λ§¤μ° ν° κ³΅λ¥  κ°’μ΄ κ³„μ‚°λ¨
2. **0μΌλ΅ λ‚λ„κΈ°**: `X_i.norm() == 0.0`μΈ κ²½μ° λ°νƒ€μ„ μ¤λ¥ λλ” NaN/Inf μƒμ„±
3. **λ°μ΄ν„° μ‹ λΆ°λ„**: μ›μ μ— λ§¤μ° κ°€κΉμ΄ ν¬μΈνΈλ” LiDAR μΈ΅μ • μ¤λ¥μΌ κ°€λ¥μ„±μ΄ λ†’μ

#### μμ • μ½”λ“ (μμ • ν›„)

```cpp
// Line 295-300 (μμ • ν›„)
// Curvature κ³„μ‚°: c = ||sum(Xi - Xj)|| / (|S| * ||Xi||)
// LOAM λ…Όλ¬Έ: c = ||Ξ£(Xi - Xj)|| / (|S| * ||Xi||)
double xi_norm = X_i.norm();
// valid_neighbors > 0 μ΄κ³  xi_norm > 0.1 μ΄λ©΄ Curvature κ³„μ‚°, μ•„λ‹λ©΄ 0.0 (Bug #1 μμ •)
double c = (valid_neighbors > 0 && xi_norm > 0.1) ? diff_sum.norm() / (valid_neighbors * xi_norm) : 0.0;
curvatures[i] = c;
```

#### μμ • ν¨κ³Ό

- β… `xi_norm > 0.1` μ΅°κ±΄ μ¶”κ°€λ΅ μ›μ  κ·Όμ² ν¬μΈνΈμ κ³΅λ¥ μ„ 0μΌλ΅ μ„¤μ •
- β… 0μΌλ΅ λ‚λ„κΈ° μ¤λ¥ μ™„μ „ λ°©μ§€
- β… μμΉμ  μ•μ •μ„± ν–¥μƒ
- β… `read_points_with_ring_pcl()` ν•¨μμ ν•„ν„°λ§ κΈ°μ¤€(0.5m)κ³Ό μΌκ΄€μ„± ν™•λ³΄

---

### π΅ Bug #3: KNN κ²€μƒ‰ κ²°κ³Ό κ²€μ¦ λ„λ½

#### μ„μΉ
- **νμΌ**: `src/loam_feature.cpp`
- **ν•¨μ**: `extract_loam_features_knn()`
- **λΌμΈ**: 279 (μμ • μ „)

#### λ¬Έμ  μ½”λ“ (μμ • μ „)

```cpp
// Line 277-282 (μμ • μ „)
std::array<size_t, 11> neighbors;
std::array<double, 11> sq_dists;
size_t num_found = kdtree.knn_search(cloud->points[i].data(), 11, neighbors.data(), sq_dists.data());

// ν„μ¬ ν¬μΈνΈ
Eigen::Vector3d X_i = cloud->points[i].head<3>();
// λ°”λ΅ μ΄μ–΄μ„ μ΄μ›ƒ ν¬μΈνΈ μ²λ¦¬...
```

#### λ¬Έμ μ 

1. **ν¬μ† ν¬μΈνΈ ν΄λΌμ°λ“**: μ „μ²΄ ν¬μΈνΈ κ°μκ°€ 11κ° λ―Έλ§μ΄κ±°λ‚, νΉμ • μμ—­μ— ν¬μΈνΈκ°€ ν¬μ†ν• κ²½μ° `num_found < 11`
2. **λ¶€μ •ν™•ν• κ³΅λ¥ **: μ΄μ›ƒμ΄ μ¶©λ¶„ν•μ§€ μ•μΌλ©΄ κ³΅λ¥  κ³„μ‚°μ μ‹ λΆ°λ„κ°€ κΈ‰κ²©ν λ‚®μ•„μ§
3. **LOAM λ…Όλ¬Έ λ¶μΌμΉ**: LOAMμ—μ„λ” μ¶©λ¶„ν• μ΄μ›ƒ(μµμ† 10κ°)μ„ μ „μ λ΅ ν•¨

#### μμ • μ½”λ“ (μμ • ν›„)

```cpp
// Line 277-288 (μμ • ν›„)
std::array<size_t, 11> neighbors;
std::array<double, 11> sq_dists;
size_t num_found = kdtree.knn_search(cloud->points[i].data(), 11, neighbors.data(), sq_dists.data());

// KNN κ²€μƒ‰ κ²°κ³Ό κ²€μ¦: μµμ† 5κ° μ΄μƒμ μ΄μ›ƒμ΄ ν•„μ” (Bug #3 μμ •)
if (num_found < 5) {
  curvatures[i] = 0.0;
  continue;
}

// ν„μ¬ ν¬μΈνΈ
Eigen::Vector3d X_i = cloud->points[i].head<3>();
// μ΄μ–΄μ„ μ΄μ›ƒ ν¬μΈνΈ μ²λ¦¬...
```

#### μμ • ν¨κ³Ό

- β… μ΄μ›ƒμ΄ 5κ° λ―Έλ§μΈ κ²½μ° ν•΄λ‹Ή ν¬μΈνΈμ κ³΅λ¥ μ„ 0μΌλ΅ μ„¤μ •ν•κ³  μ¤ν‚µ
- β… μµμ† μ΄μ›ƒ κ°μ λ³΄μ¥μΌλ΅ κ³΅λ¥  κ³„μ‚°μ μ‹ λΆ°λ„ ν–¥μƒ
- β… Edge/Planar νΉμ§•μ  μ„ νƒ μ‹ μ‹ λΆ°ν•  μ μ—†λ” λ°μ΄ν„° μ μ™Έ
- β… ν¬μ†ν• μμ—­(ν¬μΈνΈ ν΄λΌμ°λ“ κ²½κ³„ λ“±)μ—μ„μ μ•μ •μ„± ν–¥μƒ

---

### β Bug #2, #4: ν•¨μ μ‚­μ λ΅ μΈν• μμ • λ¶ν•„μ”

**`extract_loam_features_normal_based()` ν•¨μκ°€ ν„μ¬ μ½”λ“λ² μ΄μ¤μ— μ΅΄μ¬ν•μ§€ μ•μµλ‹λ‹¤.**

μ›λ³Έ νμΌμ—μ„ μ΄ ν•¨μμ™€ κ΄€λ ¨λ λ²„κ·Έλ”:
- **Bug #2**: μ •κ·ν™” ν›„ λ²•μ„  λ²΅ν„° ν¬κΈ° κ²€μ¦ (Line 338)
- **Bug #4**: μΈλ±μ¤ λ²”μ„ κ²€μ¦ λ―Έν΅ (Line 334)

**ν„μ¬ μƒνƒ**: ν•¨μ μμ²΄κ°€ μ‚­μ λμ–΄ ν•΄λ‹Ή λ²„κ·Έλ” λ” μ΄μƒ μ΅΄μ¬ν•μ§€ μ•μ

---

## λΉλ“ κ²€μ¦

### λΉλ“ ν™κ²½

- **Docker μ»¨ν…μ΄λ„**: bottom-lidar (ID: 5391fcf42791)
- **μ΄λ―Έμ§€**: kwu-cvrl/bottom-lidar:latest
- **λΉλ“ μ‹μ¤ν…**: CMake 3.22.1
- **μ»΄νμΌλ¬**: GCC (C++17 ν‘μ¤€)
- **μ‘μ—… λ””λ ‰ν† λ¦¬**: `/root/workdir`

### λΉλ“ λ…λ Ήμ–΄

```bash
cd /root/workdir/build
make -j4
```

### λΉλ“ κ²°κ³Ό

```
[ 94%] Built target gtsam_points
[ 98%] Building CXX object CMakeFiles/lidar_registration_benchmark.dir/src/main.cpp.o
[ 98%] Building CXX object CMakeFiles/lidar_registration_benchmark.dir/src/loam_feature.cpp.o
[100%] Linking CXX executable lidar_registration_benchmark
[100%] Built target lidar_registration_benchmark
```

### λΉλ“ μ„±κ³µ ν™•μΈ

```bash
$ docker exec bottom-lidar ls -lh /root/workdir/build/lidar_registration_benchmark
-rwxr-xr-x 1 root root 24M Feb 10 13:51 lidar_registration_benchmark
```

#### κ²€μ¦ κ²°κ³Ό

β… **μ»΄νμΌ μ„±κ³µ**: λ¨λ“  μ†μ¤ νμΌμ΄ μ¤λ¥ μ—†μ΄ μ»΄νμΌλ¨  
β… **λ§ν‚Ή μ„±κ³µ**: μ‹¤ν–‰ νμΌ `lidar_registration_benchmark` (24MB) μƒμ„±λ¨  
β… **κ²½κ³  μ—†μ**: μμ •λ μ½”λ“μ—μ„ μ»΄νμΌλ¬ κ²½κ³  λ°μƒν•μ§€ μ•μ  
β… **κΈ°λ¥ μ μ§€**: κΈ°μ΅΄ μ½”λ“μ λ΅μ§κ³Ό μΈν„°νμ΄μ¤ λ³€κ²½ μ—†μ

---

## κ²°λ΅ 

### μ‹¤μ  μμ • μ”μ•½

μ΄λ² μ‘μ—…μ„ ν†µν•΄ **2κ°μ λ²„κ·Έ**λ¥Ό μ„±κ³µμ μΌλ΅ μμ •ν•μ€μµλ‹λ‹¤.

| λ²„κ·Έ ID | μ‹¬κ°λ„ | μƒνƒ | μν–¥ |
|---------|--------|------|------|
| Bug #1 | π”΄ HIGH | β… μμ • μ™„λ£ | μμΉμ  μ•μ •μ„± λ° 0μΌλ΅ λ‚λ„κΈ° λ°©μ§€ |
| Bug #3 | π΅ MEDIUM | β… μμ • μ™„λ£ | ν¬μ† λ°μ΄ν„° ν™κ²½μ—μ„μ μ‹ λΆ°μ„± ν–¥μƒ |
| Bug #2 | π”΄ HIGH | β ν•΄λ‹Ή μ—†μ | ν•¨μ μ‚­μ λ¨ |
| Bug #4 | π΅ MEDIUM | β ν•΄λ‹Ή μ—†μ | ν•¨μ μ‚­μ λ¨ |
| Improvement #5 | πΆ LOW | β ν•΄λ‹Ή μ—†μ | μƒ κµ¬ν„μΌλ΅ κµμ²΄λ¨ |

### μ½”λ“ λ³€κ²½ μ‚¬ν•­

**μ΄ λΌμΈ μ λ³€ν™”**: 345μ¤„ β†’ 351μ¤„ (+6μ¤„)

**λ³€κ²½λ μ½”λ“**:
1. Line 297-300: `xi_norm` λ³€μ μ¶”κ°€ λ° 0μΌλ΅ λ‚λ„κΈ° λ°©μ§€ μ΅°κ±΄ μ¶”κ°€
2. Line 281-286: KNN κ²€μƒ‰ κ²°κ³Ό κ²€μ¦ λ΅μ§ μ¶”κ°€

### κΈ°λ€ ν¨κ³Ό

1. **μ•μ •μ„± ν–¥μƒ**: 
   - Division by zero μ™„μ „ λ°©μ§€
   - NaN/Inf κ°’ μƒμ„± λ°©μ§€

2. **μ‹ λΆ°μ„± ν–¥μƒ**: 
   - ν¬μ†ν• ν¬μΈνΈ ν΄λΌμ°λ“μ—μ„λ„ μ•μ •μ  λ™μ‘
   - μλ»λ νΉμ§•μ  μ„ νƒ λ°©μ§€

3. **μ μ§€λ³΄μμ„±**: 
   - λ…ν™•ν• μ£Όμ„μΌλ΅ μμ • μ΄λ ¥ μ¶”μ  κ°€λ¥
   - λ²„κ·Έ μμ • μ„μΉκ°€ μ½”λ“ λ‚΄μ— ν‘μ‹λ¨

### μ½”λ“λ² μ΄μ¤ μƒνƒ

**ν„μ¬ `loam_feature.cpp`λ”**:
- β… μ•μ •μ μΈ KNN κΈ°λ° LOAM νΉμ§•μ  μ¶”μ¶ μ§€μ›
- β… LIO-SAM μ¤νƒ€μΌμ Ring κΈ°λ° νΉμ§•μ  μ¶”μ¶ μ§€μ›
- β… λ¨λ“  critical λ²„κ·Έ μμ • μ™„λ£
- β οΈ Normal κΈ°λ° νΉμ§•μ  μ¶”μ¶ λ―Έμ§€μ› (ν•¨μ μ‚­μ λ¨)

### ν›„μ† μ‘μ—… κ¶μ¥μ‚¬ν•­

1. **λ‹¨μ„ ν…μ¤νΈ μ¶”κ°€**:
   - Bug #1: μ›μ  κ·Όμ² ν¬μΈνΈ μ…λ ¥ μ‹ κ³΅λ¥  = 0 κ²€μ¦
   - Bug #3: μ΄μ›ƒμ΄ 5κ° λ―Έλ§μΈ κ²½μ° κ³΅λ¥  = 0 κ²€μ¦

2. **μ—£μ§€ μΌ€μ΄μ¤ ν…μ¤νΈ**:
   - ν¬μΈνΈ κ°μκ°€ λ§¤μ° μ μ€ κ²½μ° (< 100κ°)
   - μ „μ²΄ ν¬μΈνΈκ°€ μ›μ  κ·Όμ²μ— μλ” κ²½μ°
   - KD-treeμ—μ„ μ΄μ›ƒμ„ μ°Ύμ„ μ μ—†λ” κ²½μ°

3. **μ„±λ¥ ν…μ¤νΈ**:
   - μμ •μΌλ΅ μΈν• μ„±λ¥ μν–¥ μΈ΅μ • (μμƒ: λ¬΄μ‹ν•  μ μλ” μμ¤€)
   - λ€μ©λ‰ ν¬μΈνΈ ν΄λΌμ°λ“μ—μ„μ λ™μ‘ ν™•μΈ

4. **λ¬Έμ„ν™”**:
   - ν•¨μλ³„ μ…λ ¥/μ¶λ ¥ λ…μ„Έ μ‘μ„±
   - μμƒλλ” μ—£μ§€ μΌ€μ΄μ¤ λ¬Έμ„ν™”

---

**μ‘μ„±μ**: Sisyphus (OhMyOpenCode AI Agent)  
**κ²€μ¦ μ™„λ£**: 2026λ…„ 2μ›” 10μΌ 13:51 KST  
**λΉλ“ μƒνƒ**: β… SUCCESS  
**μμ • νμΌ**: `/root/workdir/src/loam_feature.cpp`  
**μ‹¤ν–‰ νμΌ**: `/root/workdir/build/lidar_registration_benchmark` (24MB)
